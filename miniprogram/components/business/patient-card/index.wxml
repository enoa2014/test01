<pm-card
  class="patient-card patient-card--{{mode}}"
  status="{{status}}"
  variant="{{cardVariant}}"
  clickable="{{clickable}}"
  padding="{{cardPadding}}"
  useHeaderSlot="{{true}}"
  bind:tap="handleCardTap"
  bind:longpress="handleLongPress"
>
  <!-- Áä∂ÊÄÅÊåáÁ§∫Ëâ≤Êù° -->
  <view wx:if="{{statusIndicator}}" class="patient-card__status-indicator patient-card__status-indicator--{{statusIndicator.type}}"></view>

  <!-- ÊªëÂä®Êìç‰ΩúÂå∫Âüü -->
  <view wx:if="{{swipeActions && swipeActions.length}}" class="patient-card__swipe-actions">
    <view
      wx:for="{{swipeActions}}"
      wx:key="id"
      class="patient-card__swipe-action patient-card__swipe-action--{{item.type || 'default'}}"
      catchtap="handleSwipeActionTap"
      data-action="{{item.id}}"
    >
      <text class="patient-card__swipe-action-icon">{{item.icon}}</text>
    </view>
  </view>
  <view slot="header" class="patient-card__header">
    <view class="patient-card__avatar-wrapper">
      <view class="patient-card__avatar" style="background-color: {{avatarBackground}};">
        <text class="patient-card__avatar-text">{{avatarText}}</text>
      </view>
      <view wx:if="{{statusIcon}}" class="patient-card__status-icon patient-card__status-icon--{{statusIcon.type}}">
        <text class="patient-card__status-icon-text">{{statusIcon.icon}}</text>
      </view>
    </view>
    <view class="patient-card__title">
      <view class="patient-card__title-row">
        <text class="patient-card__name patient-name"
          >{{patient.name || patient.patientName || '-'}}</text
        >
        <text wx:if="{{ageText}}" class="patient-card__age">{{ageText}}</text>
        <view wx:if="{{selectable}}" class="patient-card__select" bindtap="handleSelectChange">
          <text class="patient-card__select-icon">{{selected ? '‚òë' : '‚òê'}}</text>
        </view>
      </view>
      <view wx:if="{{badges && badges.length}}" class="patient-card__badges">
        <pm-badge
          wx:for="{{badges}}"
          wx:key="text"
          class="patient-card__badge patient-card__badge--{{item.type || 'default'}}"
          text="{{item.text}}"
          type="{{item.type || 'default'}}"
          size="small"
        />
      </view>
    </view>
  </view>

  <view class="patient-card__body">
    <!-- ‰∏ªË¶Å‰ø°ÊÅØÂå∫Âüü -->
    <view wx:if="{{primaryLine || secondaryLine}}" class="patient-card__main-info">
      <view wx:if="{{primaryLine}}" class="patient-card__primary">{{primaryLine}}</view>
      <view wx:if="{{secondaryLine}}" class="patient-card__secondary">{{secondaryLine}}</view>
    </view>

    <!-- Â™í‰ΩìÈ¢ÑËßàÂå∫Âüü -->
    <view
      wx:if="{{mediaPreview && (mediaPreview.photoCount > 0 || mediaPreview.docCount > 0 || mediaPreview.thumbnails)}}"
      class="patient-card__media-preview"
    >
      <!-- ÁÖßÁâáÁº©Áï•Âõæ -->
      <view wx:if="{{mediaPreview.thumbnails && mediaPreview.thumbnails.length}}" class="media-thumbnails">
        <view
          wx:for="{{mediaPreview.thumbnails}}"
          wx:for-item="thumbnail"
          wx:key="url"
          class="media-thumbnail"
          catchtap="handleThumbnailTap"
          data-index="{{index}}"
        >
          <image
            class="media-thumbnail-image"
            src="{{thumbnail.url}}"
            mode="aspectFill"
            lazy-load="{{true}}"
          />
          <view wx:if="{{index === 2 && mediaPreview.photoCount > 3}}" class="media-thumbnail-overlay">
            <text class="media-thumbnail-count">+{{mediaPreview.photoCount - 3}}</text>
          </view>
        </view>
      </view>

      <!-- Â™í‰ΩìÁªüËÆ° -->
      <view wx:if="{{!mediaPreview.thumbnails || mediaPreview.thumbnails.length === 0}}" class="media-stats">
        <view
          wx:if="{{mediaPreview.photoCount > 0}}"
          class="media-chip media-chip--photo"
          catchtap="handleMediaTap"
          data-type="photo"
        >
          <text class="media-icon">üì∑</text>
          <text class="media-count">{{mediaPreview.photoCount}}</text>
        </view>
        <view
          wx:if="{{mediaPreview.docCount > 0}}"
          class="media-chip media-chip--doc"
          catchtap="handleMediaTap"
          data-type="doc"
        >
          <text class="media-icon">üìÑ</text>
          <text class="media-count">{{mediaPreview.docCount}}</text>
        </view>
      </view>
    </view>

    <!-- Ê†áÁ≠æÂå∫Âüü -->
    <view wx:if="{{tags && tags.length}}" class="patient-card__tags">
      <view wx:for="{{tags}}" wx:key="*this" class="patient-card__tag">{{item}}</view>
    </view>

    <!-- ÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÂå∫Âüü - Ê∑ªÂä†ÂàÜÁªÑÂàÜÈöîÁ∫ø -->
    <view wx:if="{{infoItems && infoItems.length}}" class="patient-card__info-group">
      <view class="patient-card__info">
        <view wx:for="{{infoItems}}" wx:key="label" class="patient-card__info-item">
          <text class="patient-card__info-label">{{item.label}}</text>
          <text class="patient-card__info-value">{{item.value || '‚Äî'}} </text>
        </view>
      </view>
    </view>
  </view>
</pm-card>
