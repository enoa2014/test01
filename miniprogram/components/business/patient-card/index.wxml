<pm-card
  class="patient-card patient-card--{{mode}}"
  status="{{status}}"
  variant="{{cardVariant}}"
  clickable="{{clickable}}"
  padding="{{cardPadding}}"
  useHeaderSlot="{{true}}"
  bind:tap="handleCardTap"
  bind:longpress="handleLongPress"
>
  <view slot="header" class="patient-card__header">
    <view class="patient-card__avatar" style="background-color: {{avatarBackground}};">
      <text class="patient-card__avatar-text">{{avatarText}}</text>
    </view>
    <view class="patient-card__title">
      <view class="patient-card__title-row">
        <text class="patient-card__name patient-name"
          >{{patient.name || patient.patientName || '-'}}</text
        >
        <text wx:if="{{ageText}}" class="patient-card__age">{{ageText}}</text>
        <view wx:if="{{selectable}}" class="patient-card__select" bindtap="handleSelectChange">
          <text class="patient-card__select-icon">{{selected ? '☑' : '☐'}}</text>
        </view>
      </view>
      <view wx:if="{{badges && badges.length}}" class="patient-card__badges">
        <pm-badge
          wx:for="{{badges}}"
          wx:key="text"
          class="patient-card__badge patient-card__badge--{{item.type || 'default'}}"
          text="{{item.text}}"
          type="{{item.type || 'default'}}"
          size="small"
        />
      </view>
    </view>
  </view>

  <view class="patient-card__body">
    <view wx:if="{{primaryLine}}" class="patient-card__primary">{{primaryLine}}</view>
    <view wx:if="{{secondaryLine}}" class="patient-card__secondary">{{secondaryLine}}</view>

    <!-- 媒体预览区域 -->
    <view
      wx:if="{{mediaPreview && (mediaPreview.photoCount > 0 || mediaPreview.docCount > 0)}}"
      class="patient-card__media-preview"
    >
      <view
        wx:if="{{mediaPreview.photoCount > 0}}"
        class="media-chip media-chip--photo"
        catchtap="handleMediaTap"
        data-type="photo"
      >
        <text class="media-icon">📷</text>
        <text class="media-count">{{mediaPreview.photoCount}}</text>
      </view>
      <view
        wx:if="{{mediaPreview.docCount > 0}}"
        class="media-chip media-chip--doc"
        catchtap="handleMediaTap"
        data-type="doc"
      >
        <text class="media-icon">📄</text>
        <text class="media-count">{{mediaPreview.docCount}}</text>
      </view>
    </view>

    <view wx:if="{{tags && tags.length}}" class="patient-card__tags">
      <view wx:for="{{tags}}" wx:key="*this" class="patient-card__tag">{{item}}</view>
    </view>
    <view wx:if="{{infoItems && infoItems.length}}" class="patient-card__info">
      <view wx:for="{{infoItems}}" wx:key="label" class="patient-card__info-item">
        <text class="patient-card__info-label">{{item.label}}</text>
        <text class="patient-card__info-value">{{item.value || '—'}} </text>
      </view>
    </view>
  </view>
</pm-card>
