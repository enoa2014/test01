<view class="smart-search">
  <view class="smart-search__input-row">
    <pm-input
      class="smart-search__input"
      value="{{internalValue}}"
      placeholder="{{placeholder}}"
      clearable="{{true}}"
      type="search"
      bind:input="handleInput"
      bind:clear="handleClear"
      bind:confirm="handleConfirm"
    />
    <view class="smart-search__actions">
      <view class="smart-search__action" bindtap="handleSearch">æœç´¢</view>
      <view
        class="smart-search__action advanced-filter-btn {{hasActiveFilters ? 'active' : ''}}"
        bindtap="handleToggleAdvanced"
      >
        <text>é«˜çº§ç­›é€‰</text>
        <view wx:if="{{hasActiveFilters}}" class="active-indicator">
          <pm-badge text="{{activeFilterCount}}" type="primary" size="small" />
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{loading}}" class="smart-search__loading">æ­£åœ¨åŠ è½½â€¦</view>

  <view wx:if="{{debouncedSuggestions.length}}" class="smart-search__suggestions">
    <view
      wx:for="{{debouncedSuggestions}}"
      wx:key="*this"
      class="smart-search__suggestion"
      bindtap="handleSuggestionTap"
      data-suggestion="{{item}}"
    >
      <text class="smart-search__suggestion-icon">ğŸ”</text>
      <text class="smart-search__suggestion-text">{{item}}</text>
    </view>
  </view>

  <view wx:if="{{filters.length}}" class="smart-search__filters">
    <view
      wx:for="{{filters}}"
      wx:key="id"
      class="smart-search__filter {{item.active ? 'smart-search__filter--active' : ''}} {{item.type ? 'smart-search__filter--' + item.type : ''}}"
      bindtap="handleFilterTap"
      data-filter="{{item}}"
    >
      <text class="smart-search__filter-count" wx:if="{{item.count !== undefined}}">{{item.count}}</text>
      <text class="smart-search__filter-label">{{item.label}}</text>
    </view>
  </view>

  <view wx:if="{{historyEnabled && searchHistory.length}}" class="smart-search__history">
    <view class="smart-search__history-header">
      <text class="smart-search__history-title">æœç´¢å†å²</text>
      <text class="smart-search__history-clear" bindtap="handleClearHistory">æ¸…ç©º</text>
    </view>
    <view class="smart-search__history-list">
      <view
        wx:for="{{searchHistory}}"
        wx:key="*this"
        class="smart-search__history-item"
      >
        <text class="smart-search__history-text" bindtap="handleHistoryTap" data-keyword="{{item}}">
          {{item}}
        </text>
        <text
          class="smart-search__history-delete"
          bindtap="handleDeleteHistoryItem"
          data-keyword="{{item}}"
          aria-label="åˆ é™¤å†å²è®°å½•"
        >
          âœ•
        </text>
      </view>
    </view>
  </view>
</view>
