<!--æ‚£è€…é€‰æ‹©é¡µé¢-->
<view class="theme-root select-container">
  <view class="header">
    <view class="title">æ‚£è€…å…¥ä½ç™»è®°</view>
    <view class="select-subtitle">è¯·é€‰æ‹©æ‚£è€…æˆ–åˆ›å»ºæ–°æ‚£è€…</view>
  </view>

  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-box">
      <input
        class="search-input"
        value="{{searchKeyword}}"
        placeholder="æœç´¢æ‚£è€…å§“åã€è¯ä»¶å·ç "
        bindinput="onSearchInput"
        focus="{{searchFocus}}"
      />
      <view class="search-icon" wx:if="{{!searchKeyword}}">ğŸ”</view>
      <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="onClearSearch">âœ•</view>
    </view>
  </view>

  <!-- æ‚£è€…åˆ—è¡¨ -->
  <scroll-view
    class="patient-list"
    scroll-y
    enable-lower-action="{{hasMore}}"
    bindscrolltolower="onLoadMore"
  >
    <view wx:if="{{loading && patients.length === 0}}" class="loading-state">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <view wx:if="{{!loading && patients.length === 0 && searchKeyword}}" class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æœªæ‰¾åˆ°åŒ¹é…çš„æ‚£è€…</view>
      <view class="empty-hint">è¯·æ£€æŸ¥æœç´¢æ¡ä»¶æˆ–åˆ›å»ºæ–°æ‚£è€…</view>
    </view>

    <view wx:if="{{!loading && patients.length === 0 && !searchKeyword}}" class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <view class="empty-text">æš‚æ— æ‚£è€…æ•°æ®</view>
      <view class="empty-hint">è¯·å…ˆåˆ›å»ºæ‚£è€…ä¿¡æ¯</view>
    </view>

    <view
      wx:for="{{patients}}"
      wx:key="key"
      class="patient-item"
      data-patient="{{item}}"
      bindtap="onPatientSelect"
    >
      <view class="patient-main">
        <view class="patient-name">{{item.patientName}}</view>
        <view class="patient-info">
          <text class="info-item">{{item.gender}}</text>
          <text class="info-item" wx:if="{{item.ageText}}">{{item.ageText}}</text>
          <text class="info-item" wx:if="{{item.idNumber}}">{{item.idNumber}}</text>
        </view>
      </view>

      <view class="patient-meta">
        <view class="admission-info" wx:if="{{item.admissionCount > 0}}">
          <text class="admission-count">å…¥ä½{{item.admissionCount}}æ¬¡</text>
          <text class="last-admission" wx:if="{{item.latestAdmissionDateFormatted}}">
            æœ€è¿‘ï¼š{{item.latestAdmissionDateFormatted}}
          </text>
        </view>
        <view class="new-badge" wx:if="{{item.admissionCount === 0}}">æ–°æ‚£è€…</view>
      </view>

      <view class="patient-action">
        <view class="action-icon">â†’</view>
      </view>
    </view>

    <view wx:if="{{loading && patients.length > 0}}" class="loading-more">
      <view class="loading-text">åŠ è½½æ›´å¤š...</view>
    </view>

    <view wx:if="{{!hasMore && patients.length > 0}}" class="no-more">
      <view class="no-more-text">å·²æ˜¾ç¤ºå…¨éƒ¨æ‚£è€…</view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="action-bar">
    <pm-button
      class="action-bar__button"
      type="primary"
      size="small"
      icon="ğŸ‘¤"
      text="åˆ›å»ºæ–°æ‚£è€…"
      bindtap="onCreateNewPatient"
    ></pm-button>
  </view>
</view>

<!-- ç¡®è®¤å¼¹çª— -->
<view class="confirm-modal" wx:if="{{showConfirmModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">ç¡®è®¤é€‰æ‹©æ‚£è€…</view>
    </view>

    <view class="modal-body">
      <view class="selected-patient">
        <view class="patient-name">{{selectedPatient.patientName}}</view>
        <view class="patient-details">
          <view class="detail-item">
            <text class="detail-label">æ€§åˆ«ï¼š</text>
            <text class="detail-value">{{selectedPatient.gender}}</text>
          </view>
          <view class="detail-item" wx:if="{{selectedPatient.ageText}}">
            <text class="detail-label">å¹´é¾„ï¼š</text>
            <text class="detail-value">{{selectedPatient.ageText}}</text>
          </view>
          <view class="detail-item" wx:if="{{selectedPatient.idNumber}}">
            <text class="detail-label">è¯ä»¶å·ï¼š</text>
            <text class="detail-value">{{selectedPatient.idNumber}}</text>
          </view>
          <view class="detail-item" wx:if="{{selectedPatient.phone}}">
            <text class="detail-label">è”ç³»ç”µè¯ï¼š</text>
            <text class="detail-value">{{selectedPatient.phone}}</text>
          </view>
        </view>
      </view>

      <view class="intake-hint">
        <text class="hint-text">å°†ä¸ºæ­¤æ‚£è€…è¿›è¡Œå…¥ä½ç™»è®°ï¼Œæ‚£è€…ä¿¡æ¯å¯åœ¨åç»­æ­¥éª¤ä¸­ç¼–è¾‘</text>
      </view>
    </view>

    <view class="modal-actions">
      <pm-button
        class="modal-action modal-action--cancel"
        type="default"
        size="small"
        block="{{true}}"
        bindtap="onCancelSelect"
        text="å–æ¶ˆ"
      ></pm-button>
      <pm-button
        class="modal-action modal-action--confirm"
        type="primary"
        size="small"
        block="{{true}}"
        bindtap="onConfirmSelect"
        text="ç¡®è®¤å…¥ä½"
      ></pm-button>
    </view>
  </view>
</view>
