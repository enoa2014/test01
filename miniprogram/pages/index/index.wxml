<view class="theme-root container stack gap-4">
  <view class="hero">
    <text class="title">住户档案</text>
    <text class="hero-subtitle">汇总每位住户的入住记录</text>
  </view>

  <view class="toolbar stack gap-3">
    <smart-search-bar
      value="{{searchKeyword}}"
      placeholder="搜索住户姓名、档案号或标签"
      suggestions="{{searchSuggestions}}"
      filters="{{quickFilters}}"
      loading="{{searchLoading}}"
      history-enabled="{{true}}"
      bind:input="onSearchInput"
      bind:suggest="onSearchSuggest"
      bind:search="onSearchSubmit"
      bind:clear="onSearchClear"
      bind:filtertap="onFilterTap"
      bind:toggleadv="onToggleAdvancedFilter"
    />

    <view class="toolbar-row">
      <picker
        class="sort-picker-wrapper"
        mode="selector"
        range="{{sortOptions}}"
        range-key="label"
        value="{{sortIndex}}"
        bindchange="onSortChange"
      >
        <view class="sort-picker">
          <text class="sort-text">{{sortOptions[sortIndex].label}}</text>
          <text class="sort-icon">▾</text>
        </view>
      </picker>
      <view class="toolbar-actions">
        <pm-button
          class="toolbar-action"
          text="查看分析"
          size="small"
          type="primary"
          ghost="{{true}}"
          bindtap="onAnalysisTap"
        />
        <pm-button
          class="toolbar-action"
          text="住户入住"
          size="small"
          type="primary"
          bindtap="onIntakeTap"
        />
      </view>
    </view>
  </view>

  <view wx:if="{{loading}}" class="skeleton-list">
    <view class="skeleton-item" wx:for="{{skeletonPlaceholders}}" wx:key="*this">
      <view class="skeleton-avatar"></view>
      <view class="skeleton-body">
        <view class="skeleton-line skeleton-line--title"></view>
        <view class="skeleton-badges">
          <view class="skeleton-badge" wx:for="{{[0,1]}}" wx:key="*this"></view>
        </view>
        <view class="skeleton-grid">
          <view class="skeleton-chip" wx:for="{{[0,1,2]}}" wx:key="*this"></view>
        </view>
        <view class="skeleton-line"></view>
      </view>
    </view>
  </view>
  <view wx:elif="{{error}}" class="error">{{error}}</view>
  <pm-card
    wx:if="{{!loading && !error && !displayPatients.length}}"
    class="empty-state-card"
    title="暂无住户档案"
    useFooterSlot="{{true}}"
  >
    <view class="empty-state">
      <image class="empty-illustration" src="../../assets/images/empty-patients.svg" mode="aspectFit" />
      <text class="empty-description">点击右下角按钮添加第一位住户</text>
    </view>
    <view slot="footer" class="empty-actions">
      <pm-button text="立即添加" type="primary" size="medium" bindtap="onIntakeTap" />
    </view>
  </pm-card>
  <scroll-view wx:else scroll-y class="patient-list">
    <patient-card
      wx:for="{{displayPatients}}"
      wx:key="patientKey"
      patient="{{item}}"
      mode="compact"
      status="{{item.cardStatus}}"
      badges="{{item.badges}}"
      actions="{{batchMode ? cardActionsSimplified : cardActions}}"
      selectable="{{batchMode}}"
      selected="{{item.selected}}"
      clickable="{{true}}"
      bind:cardtap="onPatientTap"
      bind:actiontap="onCardAction"
      bind:selectchange="onCardSelectChange"
      bind:longpress="onCardLongPress"
    />
  </scroll-view>

  <view class="fab-container">
    <view class="fab-button">
      <pm-button
        icon="＋"
        type="primary"
        size="large"
        icon-only="{{true}}"
        elevated="{{true}}"
        aria-label="添加住户"
        bindtap="onIntakeTap"
      />
    </view>
  </view>
</view>
