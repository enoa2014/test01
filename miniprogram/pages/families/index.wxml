<!--家庭档案列表页面-->
<view class="page bg-gray-50 min-h-screen">
  <!-- 搜索栏 -->
  <view class="search-section bg-white px-4 py-3 border-b border-gray-200">
    <search-bar
      placeholder="搜索家庭姓名、疾病类型或来源地"
      bind:search="onSearch"
      bind:filter="onShowFilter"
      showFilter="{{true}}"
      filterCount="{{activeFilterCount}}"
    />
  </view>

  <!-- 筛选面板 -->
  <filter-panel
    visible="{{showFilterPanel}}"
    filters="{{filterOptions}}"
    bind:change="onFilterChange"
    bind:close="onHideFilter"
  />

  <!-- 统计信息 -->
  <view class="stats-section px-4 py-3 bg-white mb-2">
    <view class="flex items-center justify-between">
      <text class="text-gray-600 text-sm">
        共找到 {{total}} 个家庭
      </text>
      <view class="flex items-center gap-2">
        <status-tag status="in" size="sm">在住 {{inCount}}</status-tag>
        <status-tag status="out" size="sm">已离院 {{outCount}}</status-tag>
      </view>
    </view>
  </view>

  <!-- 家庭列表 -->
  <view class="family-list px-4">
    <view
      wx:for="{{familyList}}"
      wx:key="id"
      class="mb-3"
      bindtap="onFamilyTap"
      data-family="{{item}}"
    >
      <child-card
        avatar="{{item.childAvatar}}"
        name="{{item.childName}}"
        age="{{item.childAge}}"
        diagnosis="{{item.diagnosis}}"
        status="{{item.status}}"
        checkinDate="{{item.checkinDate}}"
        roomNumber="{{item.roomNumber}}"
        guardianName="{{item.guardianName}}"
        guardianPhone="{{item.guardianPhone}}"
        bind:call="onCallGuardian"
        bind:detail="onViewDetail"
      />
    </view>

    <!-- 无数据状态 -->
    <view wx:if="{{familyList.length === 0 && !loading}}" class="empty-state py-16 text-center">
      <image src="/assets/images/empty-family.png" class="w-32 h-32 mx-auto mb-4 opacity-50" />
      <text class="text-gray-400 text-base block mb-2">暂无家庭档案</text>
      <text class="text-gray-300 text-sm">点击右下角按钮添加新家庭</text>
    </view>

    <!-- 加载更多 -->
    <view wx:if="{{hasMore && familyList.length > 0}}" class="load-more py-4 text-center">
      <loading-spinner wx:if="{{loadingMore}}" size="sm" />
      <text wx:else class="text-gray-400 text-sm" bindtap="onLoadMore">点击加载更多</text>
    </view>

    <!-- 到底提示 -->
    <view wx:if="{{!hasMore && familyList.length > 0}}" class="reach-bottom py-4 text-center">
      <text class="text-gray-300 text-sm">已显示全部数据</text>
    </view>
  </view>

  <!-- 悬浮添加按钮 -->
  <view class="fab fixed bottom-6 right-4 z-10">
    <button
      class="btn btn-lg bg-primary text-white rounded-full w-14 h-14 flex items-center justify-center shadow-primary"
      bindtap="onAddFamily"
    >
      <text class="text-2xl">+</text>
    </button>
  </view>

  <!-- 全局加载状态 -->
  <view wx:if="{{loading}}" class="loading-overlay fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-20">
    <view class="text-center">
      <loading-spinner size="lg" color="primary" />
      <text class="text-gray-600 text-sm mt-3 block">加载中...</text>
    </view>
  </view>

  <!-- Toast 消息 -->
  <toast
    wx:if="{{toast.show}}"
    type="{{toast.type}}"
    message="{{toast.message}}"
    bind:close="onToastClose"
  />
</view>