# Test Design: Story 1.19

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 14
- Unit tests: 5 (36%)
- Integration tests: 5 (36%)
- E2E tests: 4 (29%)
- Priority distribution: P0: 5, P1: 6, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: 列表骨架 + 分页/预取

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.19-UNIT-001   | Unit        | P1       | Pagination helper calculates next page & prefetch threshold | Logic-only |
| 1.19-UNIT-002   | Unit        | P1       | setData payload builder trims fields to minimal set         | Prevents overfetch |
| 1.19-INT-001    | Integration | P0       | Render list ensuring skeleton fills viewport and toggles off post data load | UX-critical |
| 1.19-INT-002    | Integration | P1       | Simulate scroll -> ensures prefetch triggered once per page | Behavior |
| 1.19-E2E-001    | E2E         | P1       | Device: weak connection list load verifying pagination & skeleton transitions | Real network behaviour |

### AC2: 详情分段 setData + 入院记录分页

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.19-UNIT-003   | Unit        | P0       | Data segmentation scheduler batches fields into phases     | Critical to avoid UI lock |
| 1.19-INT-003    | Integration | P0       | Mock detail fetch asserts base info rendered before records & attachments loaded | Ensures progressive render |
| 1.19-INT-004    | Integration | P1       | Virtual list renders only visible intake records           | Component interaction |
| 1.19-E2E-002    | E2E         | P1       | Device: open detail (large dataset) verifying smooth scroll & staged loading | UX-critical |

### AC3: 附件懒加载与重试

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.19-UNIT-004   | Unit        | P2       | Sort/cache manager avoids duplicate sort/map operations    | Logic optimization |
| 1.19-INT-005    | Integration | P1       | Retry flow ensures failed thumbnail -> retry -> success path | Behavior |
| 1.19-E2E-003    | E2E         | P1       | Device offline/online transition verifying retry UI        | Realistic scenario |

### AC4: 性能指标验证

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.19-UNIT-005   | Unit        | P2       | Performance probe script calculates TTI from telemetry input | Offline analysis |
| 1.19-E2E-004    | E2E         | P0       | Automated profile (Mpflow) capturing TTI <= targets under weak network | Critical acceptance |

### AC5: 测试 & 文档更新

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| —               | —           | —        | Coverage ensured via scenarios above; documentation inspected manually | N/A |

## Risk Coverage

- Performance regressions mitigated by 1.19-UNIT-003/005 and 1.19-E2E-004.
- Pagination errors mitigated by 1.19-UNIT-001/002 and 1.19-INT-001/002.
- Attachment retries covered by 1.19-INT-005 & 1.19-E2E-003.

## Recommended Execution Order

1. 1.19-UNIT-001
2. 1.19-UNIT-002
3. 1.19-UNIT-003
4. 1.19-UNIT-004
5. 1.19-UNIT-005
6. 1.19-INT-001
7. 1.19-INT-002
8. 1.19-INT-003
9. 1.19-INT-004
10. 1.19-INT-005
11. 1.19-E2E-001
12. 1.19-E2E-002
13. 1.19-E2E-003
14. 1.19-E2E-004
