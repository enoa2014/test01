# Test Design: Story 1.16

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 13
- Unit tests: 4 (31%)
- Integration tests: 5 (38%)
- E2E tests: 4 (31%)
- Priority distribution: P0: 4, P1: 6, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: 选择页高亮与空态 CTA

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.16-UNIT-001   | Unit        | P1       | Highlight helper wraps matched substrings correctly        | Pure string logic |
| 1.16-INT-001    | Integration | P1       | Simulate search -> verify highlight spans & empty state button visibility | Component interaction |
| 1.16-E2E-001    | E2E         | P1       | Device: search no results, tap “创建新住户” and confirm flow continues | Primary UX |

### AC2: 向导即时校验与错误计数

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.16-UNIT-002   | Unit        | P0       | Validation rules for mandatory/format/length              | Critical data integrity |
| 1.16-UNIT-003   | Unit        | P1       | Error counter aggregator tallies per-step issues          | Logic-only |
| 1.16-INT-002    | Integration | P0       | User inputs invalid data -> field errors, save disabled   | Prevents bad submissions |
| 1.16-INT-003    | Integration | P1       | Tap error banner -> scrolls to field (spy on scroll call) | Interaction logic |
| 1.16-E2E-002    | E2E         | P0       | Full wizard with invalid -> corrections -> submit success | End-to-end validation |

### AC3: 完成页 CTA

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.16-INT-004    | Integration | P1       | Render CTA layout verifying primary/secondary order + accessibility | Visual contract |
| 1.16-E2E-003    | E2E         | P1       | Device: test “查看详情”“继续添加”“返回列表” flows including list refresh | Core journey |

### AC4: 接口兼容与错误提示结构化

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.16-UNIT-004   | Unit        | P2       | Mapper transforms backend error { code, message } -> UI copy | Mapping logic |
| 1.16-INT-005    | Integration | P0       | Mock patientIntake responses (success/error) ensuring callbacks refresh list / display proper toast | Multi-component flow |
| 1.16-E2E-004    | E2E         | P0       | Weak network scenario verifying loading states and retry prompts | High-risk environment |

## Risk Coverage

- Validation loopholes mitigated via 1.16-UNIT-002 and 1.16-INT-002.
- Flow regression risk mitigated via 1.16-E2E-002/003/004.
- API contract drift guarded by 1.16-INT-005.

## Recommended Execution Order

1. 1.16-UNIT-001
2. 1.16-UNIT-002
3. 1.16-UNIT-003
4. 1.16-UNIT-004
5. 1.16-INT-001
6. 1.16-INT-002
7. 1.16-INT-003
8. 1.16-INT-004
9. 1.16-INT-005
10. 1.16-E2E-001
11. 1.16-E2E-002
12. 1.16-E2E-003
13. 1.16-E2E-004
