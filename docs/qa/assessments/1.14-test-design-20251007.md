# Test Design: Story 1.14

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 12
- Unit tests: 3 (25%)
- Integration tests: 5 (42%)
- E2E tests: 4 (33%)
- Priority distribution: P0: 3, P1: 6, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: 列表卡片层级优化

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.14-UNIT-001   | Unit        | P2       | Formatter outputs primary/secondary metadata fields       | Pure mapping logic |
| 1.14-INT-001    | Integration | P1       | Render patient-card snapshot verifying visual hierarchy    | Component layout |
| 1.14-E2E-001    | E2E         | P1       | User scrolls list verifying tap targets unaffected         | UX validation |

### AC2: 吸顶批量工具栏

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.14-UNIT-002   | Unit        | P1       | Selection counter logic handles select/deselect/clear      | State-only |
| 1.14-INT-002    | Integration | P0       | Verify sticky toolbar renders with pm-button states & disables correctly | Prevents destructive mismatch |
| 1.14-E2E-002    | E2E         | P0       | Device: batch select, perform action via toolbar, observe outcome | Critical destructive path |

### AC3: 悬浮按钮返回顶部/筛选

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.14-INT-003    | Integration | P1       | Simulate scroll thresholds triggering floating buttons     | Scroll listener behaviour |
| 1.14-E2E-003    | E2E         | P1       | Device test: tap back-to-top and return-to-filter flows     | Direct UX |

### AC4: 兼容既有筛选/搜索/批量操作

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.14-UNIT-003   | Unit        | P2       | Ensure filter preset serializer unchanged                 | Regression guard |
| 1.14-INT-004    | Integration | P1       | Regression: run existing search + new toolbar combination  | Module interaction |
| 1.14-E2E-004    | E2E         | P0       | Full journey: apply filters, enable bulk delete, ensure list updates | High-impact workflow |

### Testing & Documentation Tasks

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.14-INT-005    | Integration | P2       | Keyboard navigation through toolbar buttons                | Accessibility needs |

## Risk Coverage

- Destructive batch operations risk mitigated by 1.14-INT-002 & 1.14-E2E-002/004.
- Accessibility regression mitigated via 1.14-INT-005.

## Recommended Execution Order

1. 1.14-UNIT-001
2. 1.14-UNIT-002
3. 1.14-UNIT-003
4. 1.14-INT-001
5. 1.14-INT-002
6. 1.14-INT-003
7. 1.14-INT-004
8. 1.14-INT-005
9. 1.14-E2E-001
10. 1.14-E2E-002
11. 1.14-E2E-003
12. 1.14-E2E-004
