# Test Design: Story 1.11

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 8
- Unit tests: 1 (12.5%)
- Integration tests: 4 (50%)
- E2E tests: 3 (37.5%)
- Priority distribution: P0: 2, P1: 4, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: 顶部锚点导航条展示并吸顶

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.11-UNIT-001   | Unit        | P2       | Verify anchor config builder returns required sections    | Pure mapping logic without UI dependencies |
| 1.11-INT-001    | Integration | P1       | Render detail page header and assert sticky nav presence  | Component composition across page modules |

### AC2: 点击锚点平滑滚动并支持键盘/无障碍

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.11-INT-002    | Integration | P1       | Simulate anchor click and assert `page.scrollTo` invoked with expected offsets | Validates interaction handler and state management |
| 1.11-E2E-001    | E2E         | P1       | Real device test: keyboard navigation cycles anchors, focus and scroll update correctly | Core accessibility journey |

### AC3: 滚动时自动高亮当前区块

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.11-INT-003    | Integration | P1       | Trigger scroll events with mock positions and verify active anchor updates | Scroll spy logic crosses modules |

### AC4: 返回顶部与加载禁用

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.11-INT-004    | Integration | P0       | Ensure back-to-top invokes scroll reset and loading state blocks interactions | Prevents user trap when data pending |
| 1.11-E2E-002    | E2E         | P1       | User taps back-to-top on device -> page resets and anchors reset | Critical navigation usability |

### AC5: 保持数据展示与权限逻辑不变

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.11-E2E-003    | E2E         | P0       | Regression: verify detail sections content and permissions unaffected by nav | Ensures UX change doesn’t regress core data display |

## Risk Coverage

- Navigation regression (RISK-NAV-001) mitigated by 1.11-E2E-003.
- Accessibility failure (RISK-A11Y-002) mitigated by 1.11-E2E-001 and 1.11-INT-002.
- Loading-state misuse (RISK-PERF-003) mitigated by 1.11-INT-004.

## Recommended Execution Order

1. 1.11-UNIT-001
2. 1.11-INT-001
3. 1.11-INT-002
4. 1.11-INT-003
5. 1.11-INT-004
6. 1.11-E2E-001
7. 1.11-E2E-002
8. 1.11-E2E-003
