# Test Design: Story 1.17

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 3 (30%)
- Integration tests: 4 (40%)
- E2E tests: 3 (30%)
- Priority distribution: P0: 3, P1: 5, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: 吸顶筛选条

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.17-UNIT-001   | Unit        | P1       | Sticky threshold calculator returns offsets based on token spacing | Logic-only |
| 1.17-INT-001    | Integration | P1       | Render filter-panel wrapper verifying sticky behavior and keyboard focus | Component integration |
| 1.17-E2E-001    | E2E         | P1       | Device: Scroll dataset ensuring bar remains fixed & focusable | Real UX validation |

### AC2: 筛选摘要与清除

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.17-UNIT-002   | Unit        | P2       | Summary builder composes label strings for combinations    | Simple logic |
| 1.17-INT-002    | Integration | P1       | Apply filters -> verify pm-badge ghost tags + clear button behaviour | Component interaction |
| 1.17-E2E-002    | E2E         | P1       | User sets filters, sees summary, clears all -> data resets | Core journey |

### AC3: 空态/加载展示

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.17-INT-003    | Integration | P1       | Mock zero-data response and assert empty-state copy/buttons | Visual contract |
| 1.17-E2E-003    | E2E         | P2       | Device network failure -> ensure loading/empty transitions | Realistic scenario |

### AC4: 筛选组合持久化

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| 1.17-UNIT-003   | Unit        | P1       | Storage serializer/deserializer maintains expected schema  | Pure function |
| 1.17-INT-004    | Integration | P0       | Navigation away/back to page restores filters + toggles caches | Prevents loss of analyst context |

### AC5: 接口兼容性

| ID              | Level       | Priority | Test                                                      | Justification |
| --------------- | ----------- | -------- | --------------------------------------------------------- | ------------- |
| —               | —           | —        | Covered via regression in 1.17-INT-004；统计服务云函数为规划项（暂未实现），合约测试占位 | No new scenario needed |

## Risk Coverage

- Filter persistence failure mitigated via 1.17-UNIT-003 & 1.17-INT-004.
- UX regressions (summary/empty) mitigated via 1.17-INT-002/003 and E2E pairs.

## Recommended Execution Order

1. 1.17-UNIT-001
2. 1.17-UNIT-002
3. 1.17-UNIT-003
4. 1.17-INT-001
5. 1.17-INT-002
6. 1.17-INT-003
7. 1.17-INT-004
8. 1.17-E2E-001
9. 1.17-E2E-002
10. 1.17-E2E-003
