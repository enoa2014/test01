# 住户分析页面 UX/UI 改进复评

## 执行摘要

本次复评基于最新代码实现，结合住户列表页（`wx-project/pages/index/`）、住户详情页（`wx-project/pages/patient-detail/`）与住户录入向导（`wx-project/pages/patient-intake/wizard/`）的交互现状，对原有分析报告进行了校准。核心结论如下：
- ✅ 列表页已经沉淀了完善的状态统计、搜索建议与高级筛选体系，为分析页提供了成熟的数据入口与行动终点。
- ⚠️ 分析页缺乏与列表页同构的全局概览与筛选互通，用户无法在“查看分析”后快速回到列表执行同维度筛选。
- ⚠️ 详情页与录入向导强化了数据完整度与字段规范，但分析页对缺失字段、异常数据的识别与指引仍十分薄弱。
- ⚠️ 新增的籍贯/民族字段已在云函数与列表页使用，分析页的卡片结构与图例尚未覆盖，影响跨页面认知一致性。
- ✅（最新）新增“按性别分析”面板，并为各维度提供卡片/柱状图/圆饼图三种展示模式，支持按需切换对比视角。

### 优先级概览
| 优先级 | 数量 | 代表问题 |
| ------ | ---- | -------- |
| P0 严重 | 2 | 缺少与列表页一致的总览与筛选互通、状态图例缺席 |
| P1 重要 | 4 | 分面层级弱、数据完整度缺少提示、底部抽屉可用性低、缺乏详情跳转策略 |
| P2 优化 | 4 | 样本文案溢出、弱网络态缺失、动效反馈不足、导出/分享缺口 |

---

## 1. 跨页面现状对照

### 1.1 列表页（`wx-project/pages/index/index.wxml`）
- 通过顶部 `stat-card` 网格提供「全部/在住/待入住/已离开」核心指标，并可直接切换筛选状态。
- `smart-search-bar` + 高级筛选面板（`index.js` 中 `normalizeAdvancedFilters`）支持籍贯、民族、医生等多字段组合过滤，且会在工具栏显示已激活的筛选数量。
- 列表页提供“查看分析”按钮与浮动「添加住户」FAB，属于分析页的天然入口与回流点。

### 1.2 详情页（`wx-project/pages/patient-detail/detail.wxml`）
- 头部指标卡展示状态、入住次数、最近入住时间，强调运营指标；编辑模式覆盖基础信息、联系人与入住记录。
- `STATUS_ALIAS_CONFIG` 保证多种状态写法归一，并通过 `statusClass` 影响 UI，体现数据治理需求。
- 媒体、情况说明等字段在详情中完整呈现，但分析页未提供对应的数据质量或占比洞察。

### 1.3 住户录入向导（`wx-project/pages/patient-intake/wizard/`）
- 分步进度条、必填项提醒与身份证自动识别锁定逻辑提升了录入准确度。
- 草稿自动保存、附件上传、联系人数量校验等能力可为分析页提供数据完整度指标。
- 录入完成后通过 `PATIENT_LIST_DIRTY_KEY` 通知列表刷新，但分析页没有相应的脏数据感知机制。

---

## 2. 高优先级问题与改进建议

### P0-1 分析页缺乏与列表页一致的总览与筛选互通
- **定位**：当前 `analysis/index.wxml` 直接渲染面板列表，没有类似列表页的顶部指标/筛选提示，且卡片点击与列表页筛选系统完全脱节。
- **影响**：用户从列表页点击“查看分析”后无法在分析页获得熟悉的指标结构，也无法一键带回同维度筛选，导致洞察→行动链路断裂。
- **建议**：
  1. 复用列表页 `stat-card` 组件，在分析页首屏展示同样的四大指标，并提供“返回列表并套用该筛选”的操作。
  2. 为各分析面板提供“在列表中查看”入口，通过 `wx.navigateTo` 携带筛选参数调用 `applyAdvancedFilters`。
  3. 与后端约定统一的筛选条件结构，避免分析页独立维护一套映射逻辑。

### P0-2 状态、字段图例缺失
- **定位**：`decorateStatCards` 会使用 `status` 与 `variant` 标记最大值、未知值等语义，但 UI 中缺乏对应图例提示；新增的籍贯/民族字段也没有在页面上说明用途。
- **影响**：颜色含义、未知数据占比、缺失字段提示无法被理解，削弱数据可信度；与详情页的状态徽章、录入向导的必填提示形成割裂。
- **建议**：
  1. 在 `panel-title` 区域引入 Legend 组件，解释 `success/outlined/warning` 等视觉状态，并标示“未知/缺失数据”。
  2. 对新增字段（籍贯、民族）提供图例或说明文本，与列表页的高级筛选标签保持一致。
  3. 允许用户点击图例快速筛选「仅看未知数据」，引导回到详情页补录。

### P1-1 面板层级与穿透行为弱
- **定位**：`analysis-stat-card` 的结构仍以水平滚动展示，缺少滚动提示；卡片点击仅打开抽屉名单，无法跳转到详情或列表。
- **影响**：用户难以区分不同分面，也无法在分析页完成深度探索；与详情页的丰富上下文断开。
- **建议**：
  1. 引入 `scroll-snap` 与渐隐遮罩，提示可横向滚动，同时限制首屏展示数量。
  2. 在卡片操作上新增“查看名单”“打开详情”“应用筛选”三个明确选项。
  3. 依据 `patient.key` 直接调用 `wx.navigateTo` 跳转详情页，减少额外点击。

### P1-2 数据完整度与异常提示缺位
- **定位**：录入向导和详情页均强调必填项与草稿校验，但分析页未统计缺失地址、联系人不足、身份证未识别等异常。
- **影响**：运营人员无法在分析页快速识别需要补录的数据；未知项在统计中与正常项权重相同。
- **建议**：
  1. 新增“数据完整度”面板，统计 `address`、`contacts`、证件信息缺失的住户数量，并提供补录入口。
  2. 对未知值卡片增加醒目徽章，并在抽屉顶部显示补录步骤（跳转到详情页编辑模式）。
  3. 与云函数 `patientProfile` 的清洗逻辑对齐，确保统计口径一致。

### P1-3 底部抽屉仍易误触
- **定位**：`selection-panel` 只有关闭文本按钮，未做安全区适配；与列表页的 `patient-card` 交互不一致。
- **影响**：阅读名单时容易误触关闭，尤其在刘海屏设备上；与列表的多选批量操作体验断裂。
- **建议**：
  1. 添加顶部拖拽手柄、`catchtouchmove` 与 `padding-bottom: env(safe-area-inset-bottom)`。
  2. 在抽屉内扩展搜索、排序和批量跳转列表/详情的操作。
  3. 与列表页的批量选择模块共用组件，统一操作手势。

### P1-4 缺乏详情跳转与删除闭环
- **定位**：云函数 `patientProfile` 新增了删除流程与日志记录，但分析页未提供对接入口；卡片仅能查看名单。
- **影响**：数据运营无法在分析场景下完成“确认异常→删除/归档”的闭环。
- **建议**：
  1. 在抽屉操作中提供“打开详情”“删除住户”动作，调用现有云函数 action。
  2. 删除成功后同步触发 `PATIENT_LIST_DIRTY_KEY`，提醒列表与分析页刷新。
  3. 将删除结果写入日志后回显在分析页顶部，增强透明度。

---

## 3. 中低优先级优化（P2）

| 问题 | 定位 | 建议 |
| ---- | ---- | ---- |
| 样本文案溢出 | `analysis-stat-card__samples` 未限制行数 | 采用 `-webkit-line-clamp: 2` 或自适应标签列表，与列表页卡片一致。 |
| 弱网/超时缺乏反馈 | 列表页已有骨架与错误状态，分析页仍是空白 | 复用 `pm-card` 错误组件与重试按钮。 |
| 动效反馈不足 | 抽屉、卡片无动效 | 对齐录入向导的进度动效，统一微交互节奏。 |
| 导出/分享缺口 | 分析结果无法导出 | 支持导出为 Excel/图片，并嵌入“复制筛选条件”功能。 |

---

## 4. 建议的迭代路线
1. **阶段一（1 周内）**：补齐顶部总览、图例、卡片滚动提示与列表筛选互通能力，形成“分析→行动”闭环。
2. **阶段二（2 周内）**：上线数据完整度面板、抽屉交互优化、详情/删除入口，建立异常治理流程。
3. **阶段三（后续）**：增强导出分享、弱网反馈与动画细节，并探索与录入向导的实时校验联动。

---

## 5. 验收建议
- 使用真实数据（≥100 条）验证从列表点击“查看分析”到回列表筛选的闭环是否顺畅。
- 对新增图例、抽屉、删除流程进行可用性测试，关注移动端误触与理解成本。
- 在 iOS/Android 暗色模式下复查色彩对比度与 Legend 可读性（≥4.5:1），确保与详情/列表一致。
