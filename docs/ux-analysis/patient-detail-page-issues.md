# 住户档案页 UI/UX 问题分析报告

**分析时间**: 2025-10-03
**分析范围**: `miniprogram/pages/patient-detail/` 住户详情页面
**分析依据**: Story 1.9 需求背景、现有代码实现、微信小程序用户体验规范

---

## 一、信息架构问题

### 1.1 信息层级混乱

**问题描述**:

- **编辑模式与查看模式信息组织不一致**: 编辑模式下分为"基本信息"、"联系与紧急联系人"、"入住补充信息"三个区块,但查看模式下分为"住户基本信息"、"联系信息"、"经济情况"三个区块,用户在两种模式间切换时会产生认知负荷。
- **核心信息缺失**: 查看模式下未展示住户状态(在院/离院/去世等)、入住次数、最近入住时间等关键运营数据,与住户列表页展示信息不一致。

**影响等级**: 🔴 高
**影响范围**: 信息可查找性、模式切换流畅度

**代码位置**:

- 查看模式: [detail.wxml:197-221](miniprogram/pages/patient-detail/detail.wxml#L197-L221)
- 编辑模式: [detail.wxml:28-194](miniprogram/pages/patient-detail/detail.wxml#L28-L194)

**改进建议**:

1. **统一信息组织结构**: 编辑/查看模式采用相同的信息分组逻辑
2. **补充运营关键指标**: 在顶部或独立卡片展示住户状态、入住次数、最近入住时间
3. **建立信息优先级**: 按使用频率排序,高频信息置顶(如姓名、状态、联系方式)

---

### 1.2 表单字段配置复杂度高

**问题描述**:

- 表单字段配置分散在三个常量数组(`PATIENT_FIELD_CONFIG`, `CONTACT_FIELD_CONFIG`, `INTAKE_FIELD_CONFIG`),总计涉及 **超过25个字段**,用户在编辑时需要滚动查找,缺少搜索或快捷定位能力。
- 部分字段在编辑模式下无验证提示(如籍贯、民族为选择器,但无必填标识),用户易遗漏重要信息。

**影响等级**: 🟡 中
**影响范围**: 编辑效率、数据完整性

**代码位置**: [detail.js:97-99](miniprogram/pages/patient-detail/detail.js#L97-L99)

**改进建议**:

1. **分步表单向导**: 将长表单拆分为3-4步,每步5-7个字段,降低认知负担
2. **字段智能折叠**: 将低频字段(如备用联系人)默认折叠,点击"展开更多"显示
3. **必填标识增强**: 使用醒目的视觉标识(如红色星号 + "必填"文本)

---

## 二、交互流程问题

### 2.1 编辑模式退出机制不友好

**问题描述**:

- **离开确认逻辑不一致**: 代码中实现了 `wx.enableAlertBeforeUnload` 离开提示([detail.js:686-692](miniprogram/pages/patient-detail/detail.js#L686-L692)),但微信小程序环境中该API支持度有限,实际可能无法触发。
- **放弃编辑需二次确认**: 用户点击"放弃"按钮后还需再次确认([detail.js:774-783](miniprogram/pages/patient-detail/detail.js#L774-L783)),操作路径过长。
- **保存按钮禁用时缺少反馈**: 当表单有校验错误时,保存按钮仅变灰(`disabled`类),未主动提示错误原因,用户需自行查找红色错误提示。

**影响等级**: 🔴 高
**影响范围**: 编辑操作挫败感、误操作风险

**代码位置**:

- 离开确认: [detail.js:686-692](miniprogram/pages/patient-detail/detail.js#L686-L692)
- 放弃确认: [detail.js:774-783](miniprogram/pages/patient-detail/detail.js#L774-L783)
- 保存按钮: [detail.wxml:15-19](miniprogram/pages/patient-detail/detail.wxml#L15-L19)

**改进建议**:

1. **简化放弃流程**: 首次点击"放弃"时直接取消编辑,仅在有未保存修改时弹窗确认
2. **保存前主动校验提示**: 点击保存时,若有错误,使用 `wx.showModal` 列出所有错误字段,并支持点击跳转定位
3. **增加"暂存草稿"功能**: 允许用户保存中间状态,避免长表单填写中断导致数据丢失

---

### 2.2 入住记录历史交互单一

**问题描述**:

- **排序交互不明确**: 当前仅支持"最新在前/最早在前"排序切换,按钮状态为文本描述(`▼ 最新在前`),视觉提示较弱。
- **无筛选能力**: 当住户有多次入住记录时,无法按医院、时间范围、医生等条件筛选,用户需逐条浏览。
- **记录展开/折叠缺失**: 所有入住记录默认全部展开,内容过长时滚动体验差,建议实现折叠列表,仅展示核心信息(时间、医院、状态)。

**影响等级**: 🟡 中
**影响范围**: 历史记录查找效率

**代码位置**: [detail.wxml:223-285](miniprogram/pages/patient-detail/detail.wxml#L223-L285)

**改进建议**:

1. **增强排序控件**: 使用图标 + 文本组合,提供更多排序维度(如按医院分组、按时间倒序)
2. **添加筛选面板**: 复用首页的高级筛选组件(`filter-panel`),支持时间区间、医院、医生多条件筛选
3. **卡片式折叠布局**: 默认仅显示"时间 + 医院 + 状态",点击展开显示详细医疗情况

---

## 三、视觉设计问题

### 3.1 编辑模式视觉区分度不足

**问题描述**:

- **编辑提示不明显**: 进入编辑模式后,仅顶部有一行灰色提示文字"未保存的修改离开页面将丢失,请完成校验后点击保存"([detail.wxml:23-25](miniprogram/pages/patient-detail/detail.wxml#L23-L25)),无背景色或边框突出,用户易忽略。
- **字段间距过小**: 编辑表单中相邻输入框间距为 `var(--space-2)`(约16rpx),在小屏设备上易误触。
- **必填字段无统一视觉标识**: 仅部分字段通过校验错误提示告知必填,用户事后才知道,建议前置标识。

**影响等级**: 🟡 中
**影响范围**: 编辑模式可感知性、误操作率

**代码位置**:

- 编辑提示: [detail.wxml:23-25](miniprogram/pages/patient-detail/detail.wxml#L23-L25)
- 表单样式: [detail.wxss:75-85](miniprogram/pages/patient-detail/detail.wxss#L75-L85)

**改进建议**:

1. **强化编辑模式视觉**: 整个编辑区域使用浅黄色背景(`--color-warning-light`),顶部增加图标提示
2. **增加字段间距**: 将表单字段间距调整为 `var(--space-3)` 或 `var(--space-4)`
3. **必填标识前置**: 在字段标签右侧添加红色星号 `*`,配合 `required` 属性

---

### 3.2 媒体资料区域布局不合理

**问题描述**:

- **照片墙与文档列表视觉割裂**: 两种展示形式(网格 vs 表格)风格差异大,切换时跳跃感强。
- **配额信息不直观**: 当前显示为"数量:10/20(剩余10)",数字密集且无进度条可视化,用户难以快速评估剩余空间。
- **上传按钮位置不符合习惯**: 上传按钮在配额信息下方,而非在内容列表顶部或底部的常见位置。

**影响等级**: 🟡 中
**影响范围**: 附件管理体验、视觉一致性

**代码位置**:

- 媒体区域: [detail.wxml:298-463](miniprogram/pages/patient-detail/detail.wxml#L298-L463)
- 配额显示: [detail.wxml:313-322](miniprogram/pages/patient-detail/detail.wxml#L313-L322)

**改进建议**:

1. **统一卡片风格**: 文档列表也采用卡片式布局,与照片墙视觉一致
2. **配额可视化**: 使用进度条(progress组件)展示配额使用率,配色分阶段(绿色<70%, 黄色70-90%, 红色>90%)
3. **调整上传按钮位置**: 放置在内容列表上方,与Tab平级,形成"Tab切换 → 上传操作 → 内容列表"的自然流程

---

## 四、性能与技术问题

### 4.1 长列表滚动性能隐患

**问题描述**:

- **入住记录无虚拟滚动**: 当住户有数十条入住记录时,全部渲染会导致页面卡顿,尤其在低端设备上。
- **media数据重复请求**: 每次切换Tab(照片墙/文档列表)时,未缓存已加载数据,可能触发重复请求。

**影响等级**: 🟡 中
**影响范围**: 页面流畅度、数据流量消耗

**代码位置**:

- 入住记录渲染: [detail.wxml:235-284](miniprogram/pages/patient-detail/detail.wxml#L235-L284)
- 媒体Tab切换: [detail.js:1199-1208](miniprogram/pages/patient-detail/detail.js#L1199-L1208)

**改进建议**:

1. **分页加载入住记录**: 初始仅加载最近10条,提供"加载更多"按钮或触底自动加载
2. **媒体数据缓存**: 首次加载后缓存到 `data.media.imagesCache` 和 `documentsCache`,切换Tab时优先使用缓存

---

### 4.2 表单校验反馈滞后

**问题描述**:

- **实时校验触发时机单一**: 当前仅在 `bindinput` 时触发校验,用户输入中文时,因输入法未确认导致校验延迟。
- **校验错误提示位置分散**: 错误信息在每个字段下方单独显示,用户需逐个查看,缺少"错误汇总"面板。

**影响等级**: 🟡 中
**影响范围**: 表单填写流畅度、错误定位效率

**代码位置**:

- 字段校验: [detail.js:659-693](miniprogram/pages/patient-detail/detail.js#L659-L693)
- 错误展示: [detail.wxml:46-48](miniprogram/pages/patient-detail/detail.wxml#L46-L48)

**改进建议**:

1. **增加 `bindblur` 校验**: 在字段失焦时执行完整校验,补充 `bindinput` 的实时性不足
2. **顶部错误摘要**: 当有多个错误时,在表单顶部展示"共N个错误,点击跳转"的提示栏

---

## 五、无障碍与包容性问题

### 5.1 缺少无障碍标签

**问题描述**:

- **图标按钮无文本描述**: 编辑按钮、排序按钮、删除按钮等仅使用文本或符号,未添加 `aria-label` 或 `aria-role` 属性,屏幕阅读器无法正确朗读。
- **错误提示无焦点管理**: 表单校验错误时,未自动聚焦到第一个错误字段,用户需手动查找。

**影响等级**: 🟢 低
**影响范围**: 视障用户体验、政府/企业合规性

**改进建议**:

1. **添加无障碍属性**: 为所有可交互元素添加 `aria-label`,如 `<view aria-label="编辑资料" bindtap="onEditStart">编辑资料</view>`
2. **错误自动聚焦**: 校验失败时,调用 `wx.createSelectorQuery` 滚动到第一个错误字段

---

### 5.2 色彩对比度不足

**问题描述**:

- **次要文本颜色过浅**: 部分提示文字使用 `var(--color-text-tertiary)`(可能为#999),在白色背景上对比度可能低于WCAG AA标准(4.5:1)。
- **禁用状态反馈单一**: 保存按钮禁用时仅通过颜色变灰区分,未添加"禁用"文本或图标。

**影响等级**: 🟢 低
**影响范围**: 低视力用户、强光环境下可读性

**改进建议**:

1. **检查设计令牌色值**: 确保所有文本颜色对比度符合WCAG AA标准
2. **禁用状态复合反馈**: 按钮禁用时,除变灰外,添加图标(如🔒)或文本"不可保存"

---

## 六、优先级改进路线图

### P0 - 关键体验问题(1-2周)

1. ✅ **补充运营关键指标**: 展示住户状态、入住次数、最近入住时间
2. ✅ **简化编辑模式退出流程**: 减少确认弹窗,增加暂存草稿功能
3. ✅ **保存前主动校验提示**: 汇总所有错误并支持定位

### P1 - 体验优化(2-4周)

4. ✅ **统一编辑/查看模式信息结构**: 一致的分组逻辑
5. ✅ **入住记录折叠列表**: 默认展示核心信息,点击展开详情
6. ✅ **媒体配额可视化**: 使用进度条替代纯文本

### P2 - 进阶增强(4-8周)

7. ✅ **分步表单向导**: 拆分长表单为多步流程
8. ✅ **入住记录筛选**: 复用filter-panel组件
9. ✅ **长列表分页加载**: 优化性能

### P3 - 无障碍与合规(持续优化)

10. ✅ **添加无障碍标签**: aria-label、焦点管理
11. ✅ **色彩对比度检查**: 确保WCAG合规

---

## 七、设计原则建议

1. **渐进式信息披露**: 优先展示高频信息,低频信息折叠或分步呈现
2. **一致性优于创新**: 编辑/查看模式、不同Tab的交互保持一致
3. **容错性设计**: 提供撤销、草稿保存、自动恢复等机制
4. **性能优先**: 长列表、大数据量场景优先考虑分页、虚拟滚动
5. **无障碍友好**: 所有操作支持键盘/屏幕阅读器,色彩对比度合规

---

## 附录:相关文件清单

- 页面主文件: `miniprogram/pages/patient-detail/detail.{js,wxml,wxss}`
- 表单配置: `miniprogram/pages/patient-detail/constants.js`
- 表单工具: `miniprogram/pages/patient-detail/form-utils.js`
- 媒体服务: `miniprogram/pages/patient-detail/media-service.js`
- 基础组件: `miniprogram/components/base/pm-input/`
- 设计令牌: `miniprogram/styles/generated/tokens.wxss`

---

**报告生成者**: Claude Code SuperClaude
**分析方法**: 代码审查 + Story需求对比 + 微信小程序最佳实践
