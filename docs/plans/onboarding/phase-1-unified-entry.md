# 入职与权限开通 · 阶段1：统一入口（邀请 + 自助申请）

目标（2 周内）
- 管理端“添加成员”完成一体化：创建邀请码 → 自动生成二维码 → 复制链接 → 打印海报（一步完成）
- 小程序“自助申请”入口统一且可直达（社工/志愿者/家长）
- 扫码/链接/手输三种方式任一皆可在 1–2 分钟内完成激活

范围与交付
- 管理端
  - [x] 创建邀请码后自动生成二维码（已完成）
  - [x] 邀请列表二维码缩略图/预览/下载（已完成）
  - [x] 批量生成二维码、导出海报（PDF）（已完成）
  - [ ] 创建完成弹窗：同时提供“复制激活链接”“打印海报”快捷操作
  - [ ] 批量导入成员（CSV/Excel）：为每人生成邀请并可一键生成海报包
- 小程序端
  - [x] 邀请激活页支持二维码 scene/code 自动解析并自动激活（已完成）
  - [ ] 欢迎页统一加入“自助申请”显著入口（社工/志愿者/家长），从任意入口 2 步完成
- 服务端（云函数）
  - [x] rbac.generateInviteQr：生成小程序码（已完成）
  - [ ] rbac.createInvite 扩展返回可分享链接（pages/auth/invite-code/index?code=XXXX）
  - [ ] 发送服务通知（可选）：邀请创建后向手机号/邮箱发送链接（需网关）

技术方案（关键改动）
- 分享链接规范
  - H5/小程序直达链接：`pages/auth/invite-code/index?code=XXXXXXXX`
  - 小程序码 scene：`i:XXXXXXXX`
- 新 UI 交互
  - 创建成功 → 弹窗：显示二维码预览、复制链接按钮、打印海报、继续创建
  - 邀请列表增加“复制链接”按键（与二维码并列）
- 自助申请
  - 欢迎页添加明确 CTA：“我是社工/志愿者/家长”，点入各自申请页（现有页复用/微调）

验收标准
- 管理端创建成功后，在 1 次点击内获得二维码与可分享链接；复制链接正确可用
- 新成员通过链接或扫码可 2 分钟内完成激活；审计日志出现 invite.qr 与 role.activate
- 批量导出海报：每个邀请 1 页，A4 纸面打印清晰，包含角色、剩余次数、过期时间、二维码与 8 位邀请码

任务清单
- Web（/web-admin）
  - [ ] 邀请创建完成弹窗：复制链接（clipboard）、打印海报（复用预览弹窗）
  - [ ] 邀请列表每行新增“复制链接”；顶部“批量复制链接”为多选项
  - [ ] 批量导入成员（CSV/Excel）页：解析表头（name, phone/email, role, scope, expires, uses），逐条调用 createInvite
- 小程序（/wx-project）
  - [ ] 欢迎页 CTA 区域：三个角色自助申请入口，保留原有“邀请码激活”入口
- 云函数（/cloudfunctions）
  - [ ] rbac.createInvite 返回分享链接（与 code 一起返回）
  - [ ] （可选）集成短信/邮件网关，发送邀请链接（需配置开关与频控）

风控与追踪
- 生成/复制/下载/打印操作写入审计（invite.link, invite.poster）
- 创建/发送接口限速；二维码生成频控；导入时批量阈值控制（如 500 条/次）

里程碑
- W1：UI 联调（创建弹窗/复制链接/自助申请 CTA）+ 单链路 E2E
- W2：批量导入 + 海报批量导出 + 指标看板（激活率、TTFU）

---

# 附：分享与打印模板
- 分享链接：可选短链或小程序路径 + 参数（code）
- 海报内容：二维码（360px）+ 邀请码 + 角色徽章 + 过期与剩余次数 + 机构话术
