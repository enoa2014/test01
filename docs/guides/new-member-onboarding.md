# 新成员注册与权限开通（社工/志愿者/家长）

目标：让新成员在 1–2 分钟内完成注册并获得匹配权限，同时保证审计与安全合规。

## 角色与典型权限
- 社工（social_worker）：患者管理、康复计划、文件上传、数据查看（按院区/项目范围）
- 志愿者（volunteer）：活动参与、记录上传、部分数据查看（按活动/班次范围）
- 家长（parent）：查看与补充本人孩子的档案、上传凭证、沟通协作（仅本人范围）

## 总体原则
- 单一入口：邀请链接/二维码或自助申请，不让用户在多个页面跳转来回。
- 渐进授权：先开“入门权限”，完成资料与培训后自动升级正式角色。
- 有限范围：角色总是绑定“数据访问范围”（院区/项目/患者），最小化授权。
- 可审计：创建/发送/验证/授予/撤销全过程都有日志与状态。

---

## 流程 A：管理员预邀请（优先推荐）

适用：社工入职、志愿者批量招募、家长现场办理（扫码）。

1) 管理员创建邀请
- 入口：管理端 → 组织/成员 → “添加成员”
- 填写：姓名 + 手机/邮箱（至少一项）
- 设置：目标角色（社工/志愿者/家长）+ 数据范围（院区/项目/患者）+ 生效/到期日
- 发送：生成一次性邀请（7 天默认），同步短信/邮件/服务通知 + 二维码

2) 新成员接收并验证
- 打开邀请链接/扫码 → 一键验证（短信 OTP 或企业邮箱域名白名单）
- 同意《隐私与数据使用条款》
- 自动创建/绑定账号（未注册自动建档）

3) 完成必要任务（渐进式）
- 社工：完善个人资料 → 阅读准入指南 → 简短测验（可选）→ 自动升级“社工（正式）”
- 志愿者：补充身份证/紧急联系人 → 接受行为公约 → 获得志愿者权限（按活动/班次范围）
- 家长：绑定孩子信息 → 实名校验（可选）→ 获得家长权限（仅本人孩子）

4) 通知与审计
- 管理员与新成员各收到“已激活”通知
- 审计日志记录：创建 → 发送 → 接受 → 权限授予/升级

优势：一步到位、无需“先打开小程序建档再授予”，转化率最高。

---

## 流程 B：自助申请 + 管理员审批

适用：社工常态化入职、志愿者主动报名。

1) 新成员提交申请
- 小程序欢迎页 → 选择身份 → 填写手机号/企业邮箱/工号 + 资料与附件
- 社工需说明归属部门与工作范围；志愿者选择意向活动；家长绑定孩子信息

2) 审批与授予
- 管理端审批中心收到工单 → 一键通过/驳回（可填写备注）
- 通过后：按模板授予角色与数据范围；驳回后：系统发送原因与改进指引

3) 通知与审计
- 新成员收到结果通知；审计记录审批动作与原因

优势：不依赖邀请链路，适合入口分散与常态化入职。

---

## 志愿者/家长的邀请细化（邀请码/二维码）

志愿者与家长的场景常用“邀请代码 + 二维码”组合，便于线下快速分发：

- 生成规则：8 位大写字母数字，默认 7 天有效，支持 1–100 次使用次数
- 绑定范围：
  - 志愿者：可绑定活动/班次/项目组（使用后只获得对应范围的权限）
  - 家长：可绑定具体患者（使用后仅能访问该名孩子）
- 激活步骤：扫码 → 验证手机 → 同意条款 → 自动授予范围内权限
- 并发与安全：使用次数原子扣减、验证码限速、防重复使用

---

## 用户体验要点

- 单一路径与进度：顶部显示 3 步进度（验证 → 资料 → 完成），不超过 2 屏
- 失败可恢复：验证码过期/网络失败时提供一键重试与改用邮箱验证
- 明确状态：待处理/已通过/已拒绝/已撤销，在页面与通知中一致显示
- 多通道触达：短信 + 邮件 + 小程序服务通知 + 二维码（任一可完成）

---

## 安全与合规

- 身份验证：
  - 手机 OTP（限速/次数限制）或企业邮箱域名白名单（如 @org.com）
  - 二次验证（高风险操作时）
- 授权最小化：
  - 始终绑定“数据访问范围”（院区/项目/患者），默认最小权限模板
  - 志愿者/家长默认不可导出/删除，仅上传/查看（范围内）
- 期限与回收：邀请限期、试用期权限、离职/活动结束自动回收
- 审计：创建/发送/接受/审批/撤销/范围变更等全链路记录

---

## 运营与自动化

- HR/组织同步（JML）：入职自动发邀请；转岗调范围；离职自动回收
- 提醒策略：48 小时未激活自动提醒；7 天失效后通知管理员重发
- 模板化：角色模板（社工/志愿者/家长）+ 数据范围模板（院区/活动/患者）

---

## 指标与目标

- 首次可用时间（TTFU）：中位数 < 2 分钟
- 激活率：7 天内激活 ≥ 90%
- 管理员操作数：添加 1 人 ≤ 3 次点击（含套用模板）
- 错误率：验证码错误/超时/入口走丢 < 5%

---

## 常见问题与排错

- 收不到验证码：检查号码与运营商屏蔽；改用邮箱验证；允许重发（限速）
- 邀请失效：管理员重发，或成员走“自助申请”兜底
- 授权过宽：统一从模板下发并绑定范围；开启定期权限复核（每 6 个月）
- 绑定错误孩子：家长可发起“更正申请”，管理员审核后变更绑定

---

## 建议落地顺序（迭代）
1. 增加“添加成员 → 发送邀请（含二维码）”与“自助申请”两个统一入口
2. 引入数据范围模板与角色模板；默认限权 + 期限
3. 上线多通道触达与提醒；完成审计与报表
4. 打通 HR/企业微信/飞书同步，JML 自动化与定期复核

