# Story 001.4: 业务组件开发与 API 集成

## Status

**当前状态**: Done

## Story

**作为** 前端开发工程师，
**我想要** 定义患者管理相关业务组件并完成与后端 API 的集成方案，
**从而** 支撑核心页面重构时的数据展示、交互处理与服务调用，确保体验一致、逻辑清晰、接口稳定。

## Acceptance Criteria

1. **PatientCard 组件规范完成**：覆盖多种展示模式、状态标记与快捷操作。
2. **PatientForm 组件规范完成**：梳理表单模块、校验、自动保存与权限控制。
3. **SmartSearchBar 组件规范完成**：明确搜索流程、建议、历史与多输入方式。
4. **FilterPanel 组件规范完成**：定义 schema、预设方案、逻辑组合与交互规则。
5. **StatCard 组件规范完成**：描述指标与图表展示、趋势算法、性能要求。
6. **Timeline 组件规范完成**：呈现事件时间轴、过滤、分页与高亮策略。
7. **API 规范输出**：统一列出业务组件依赖的接口、字段与错误码。
8. **组件与 API 集成指南完成**：阐述数据适配、状态管理、错误处理与缓存策略。
9. **性能与无障碍要求明确**：每个组件包含响应时间、键盘/屏读要求。
10. **文档与验证清单完整**：提供业务组件、API、集成文档及测试建议。

## Tasks / Subtasks

- [x] **PatientCard 组件规范** (AC: 1, 9)
  - [x] 定义属性、事件、状态与 UI 规则
  - [x] 列出数据字段映射与接口依赖
  - [x] 说明交互细节、无障碍与性能指标
  - [x] 给出测试要点与版本记录

- [x] **PatientForm 组件规范** (AC: 2, 9)
  - [x] 拆分表单模块与字段 schema
  - [x] 明确校验、自动保存与权限控制
  - [x] 指定与后端 API 的映射
  - [x] 补充无障碍与性能要求

- [x] **SmartSearchBar 组件规范** (AC: 3, 9)
  - [x] 说明属性、事件、搜索流程
  - [x] 定义建议/历史接口与节流策略
  - [x] 记录键盘操作、错误处理

- [x] **FilterPanel 组件规范** (AC: 4, 9)
  - [x] 描述 schema、预设方案、逻辑组合
  - [x] 约定 API 交互与错误处理
  - [x] 列出无障碍、性能与测试要点

- [x] **StatCard 组件规范** (AC: 5, 9)
  - [x] 定义指标展示、趋势算法、图表配置
  - [x] 说明数据源、状态与性能
  - [x] 给出测试清单

- [x] **Timeline 组件规范** (AC: 6, 9)
  - [x] 确认数据结构、分页与过滤
  - [x] 描述交互、无障碍与性能要求

- [x] **API 规范整理** (AC: 7, 10)
  - [x] 整理患者、搜索、筛选、时间线、指标相关接口
  - [x] 统一数据格式、错误码、版本策略

- [x] **集成与流程指引** (AC: 8, 10)
  - [x] 编写页面装配、状态管理与缓存策略
  - [x] 约定错误处理与日志埋点
  - [x] 提供集成检查清单

## Dev Notes

- 业务组件均基于 Story 001.1 的设计令牌与样式体系，确保视觉与交互一致。
- 文档覆盖组件属性、事件、数据契约、错误处理、测试与性能要求，便于后续实施。
- API 规范统一采用 REST + 标准返回结构，为联调与版本演进打下基础。

## Change Log

| 日期       | 版本 | 说明                                      | 作者          |
| ---------- | ---- | ----------------------------------------- | ------------- |
| 2024-12    | 1.0  | 初始故事创建，明确业务组件与 API 集成需求 | Product Owner |
| 2025-09-22 | 1.1  | 输出全部业务组件规范、API 约定与集成指南  | Dev Agent     |
| 2025-09-23 | 1.2  | QA 验证通过，状态更新为 Done              | Product Owner |

## Dev Agent Record

### Agent Model Used

- Codex (GPT-5) 单次会话

### Debug Log References

- `docs/business-components/patient-card.md`
- `docs/business-components/patient-form.md`
- `docs/business-components/smart-search-bar.md`
- `docs/business-components/filter-panel.md`
- `docs/business-components/stat-card.md`
- `docs/business-components/timeline.md`
- `docs/business-components/integration-guide.md`
- `docs/api/business-components.md`

### Completion Notes List

- 产出六大业务组件的详细规范，涵盖属性、事件、状态、性能与测试建议
- 整理统一的业务 API 交互协议与错误码策略
- 编写组件与 API 集成指南，明确数据适配、缓存、错误处理与验证清单

### File List

- docs/business-components/patient-card.md
- docs/business-components/patient-form.md
- docs/business-components/smart-search-bar.md
- docs/business-components/filter-panel.md
- docs/business-components/stat-card.md
- docs/business-components/timeline.md
- docs/business-components/integration-guide.md
- docs/api/business-components.md
- docs/stories/001.4.business-components-api.md

## QA Results

- Gate Decision: PASS – 六大业务组件规范、统一 API 协议与集成指引均已落地，性能/无障碍要求明确。
- Evidence:
  1. 组件规范：`docs/business-components/patient-card.md:1` 至 `timeline.md:1` 分别定义属性、事件、无障碍与性能指标，满足 AC1–AC6、AC9。
  2. API 套件：`docs/api/business-components.md:1` 统一了查询、筛选、时间线、统计接口与错误码，对应 AC7。
  3. 集成流程：`docs/business-components/integration-guide.md:1` 明确组件装配、状态管理、缓存与错误处理 checklist，覆盖 AC8、AC10。
- Acceptance Criteria Review: AC1–AC10 全部满足，文档体系完整，未发现缺项。
- Testing Status: 文档评估阶段，未执行自动化测试。
- Recommendations: 后续在实际开发中按指南编写示例页面与自动化测试脚本，持续校验 API 变更。
