# 代码评审与协作规范

## 评审目标
- 保障编码风格、架构与设计系统一致。
- 提前发现性能、无障碍、安全风险。
- 形成透明的知识共享流程。

## PR 规范
1. 标题示例：`feat(components): add pm-button states`。
2. 内容需包含：
   - 变更摘要
   - 关联故事/任务链接
   - 截图或动图（如涉及 UI）
   - 自测清单：`lint`、`test`, 微信开发者工具预览
   - 风险与回滚方案
3. PR 尺寸：
   - 单次改动控制在 400 行以内；更大改动需提前拆分。
   - 大文件或自动生成文件应在描述中注明。

## 评审角色
| 角色 | 责任 |
|------|------|
| 作者 | 提供上下文、保证自测通过、积极响应反馈 |
| 前端 Reviewer | 检查代码质量、架构、测试、性能 |
| 设计/UX Reviewer | 校验视觉与交互一致性（必要时） |
| QA Reviewer | 检查测试覆盖范围、验收标准 |

## 评审清单
- 代码风格：是否通过 lint、是否遵循组件目录约定。
- 设计一致性：是否引用设计令牌、组件 API 是否统一。
- 功能正确性：自测截图、关键路径是否覆盖。
- 测试：是否新增/更新单元测试、覆盖率是否满足要求。
- 性能与无障碍：是否引入无关依赖、是否存在阻塞渲染的逻辑、交互是否可达。
- 文档：是否更新相关 Markdown 文档与 CHANGELOG。

## 工具支持
- 使用 GitHub Review 或飞书机器人提醒待审批。
- 结合 `Danger.js` 或自定义机器人，在缺失测试/文档时给出提示。
- 在 PR 模板中嵌入 checklist，减少遗漏。

## 沟通方式
- 争议或疑问优先在 PR 评论中讨论，沉淀记录。
- 超过 2 个工作日未回复的评论，自动升级到群组提醒。
- 对复杂需求可开设计 + 开发联合评审会，确认方案后再开发。

## 合并策略
- 禁止直接向 `main` 推送，所有变更需通过 PR。
- 默认使用 squash merge，保持提交记录简洁。
- 合并前确保 CI 通过，并由至少两名 Reviewer 同意。

## 回顾与改进
- 每个 Sprint 回顾评审效率：耗时、评论数、发现的问题。
- 收集典型例子沉淀为最佳实践或常见问题。
- 对重复出现的问题补充自动化检查或模板。

## 入职培训
- 新成员需阅读本规范，并在首个 PR 由资深开发陪审。
- 通过示例演示优/劣 PR，提高评审质量。
