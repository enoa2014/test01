# 住户分析页 UI/UX 设计说明（v1）

## 目标与范围
- 以“快速定位问题与异常”为核心，提供概览 → 分析 → 名单 → 详情的闭环体验。
- 支持按“时间范围 + 状态”全局筛选，分面分析（人口学/医护/来源/趋势），以及数据质量修复入口。

## 已有能力（实现概览）
- 概览卡片：总量/在住/待入住/已离开，点击可回传筛选到列表。
- 分析面板：年龄段、性别、籍贯、月份/年份、医院、医生；支持卡片/柱状/饼图切换，饼图懒绘制。
- 选择面板：点统计项弹出名单，支持“在列表中查看”与直达详情。
- 数据完整度：缺地址/联系人不足/证件缺失/籍贯民族缺失提示（已接入后端轻量联系人）。
- 分析页已整合：全局筛选条（时间/状态）、自适应默认视图（≤5饼图，>5柱状）、Top-N+“其他”聚合。

## 主要问题与洞察
- 全局筛选入口分散（状态在卡片、时间不显著），缺一键清除。
- 面板优先级不清晰，趋势与状态应更靠前；医生/医院宜次级展示。
- 长尾噪声大，Top-N 聚合缺省未启用；数据质量缺直达修复闭环。

## 信息架构与布局（建议）
- 顶部（吸顶）：
  - KPI 概览（4 卡）+ 筛选芯片（时间：近30天/本月/本年/全部；状态：全部/在住/待入住/已离开）+ “清除筛选”。
  - 图例说明：最大值=success，常规=info，缺失=warning。
- 内容分区（由上到下）：
  - 状态分布（柱状，快速筛选）。
  - 趋势快照（月/年）。
  - 人口学（年龄/性别/籍贯）：Top 8 + “其他”。
  - 医疗来源（医院/医生）：默认折叠展开。
  - 数据质量（优先级排序），每项提供“去详情完善”。

## 交互与状态
- 自适应默认视图：类目 ≤5 → 饼图；>5 → 柱状；无数据 → 卡片占位。
- 联动：卡片/芯片/面板点击均可设置筛选，顶部展示当前筛选并可一键清除。
- 名单抽屉：显示总数+Top N，CTA：在列表中查看/直达详情/关闭。
- 空态与错误：空数据给出“下一步建议”；错误集中显示“重试/回列表”。

## 性能策略
- 饼图懒绘制 + IntersectionObserver 面板级懒加载。
- Top-N 聚合降低渲染项；筛选变化仅重建受影响面板。

## 数据契约与后端
- 列表接口（`patientProfile` action=`list`）新增：
  - `familyContacts`（≤5，去重后的轻量联系人）、`hasValidContact: boolean`、`contactCount: number`。
  - 缓存命中新增校验：无上述字段的旧缓存将强制重建。
- 前端数据质量“联系人不足”判定基于上述字段，避免全量误报。

## 路由与入口
- 主页面：`pages/analysis/index`（住户分析）。
- 入口按钮：列表页工具栏“查看分析”跳转（`pages/index/index.wxml`）。

## 验收指标
- 首次渲染 < 800ms（不含云函数 RTT）；模式切换 < 200ms。
- 数据质量修复闭环：从提示到详情补录返回后自动刷新，成功率 100%。

## 后续规划
- 抽象筛选条/面板为通用组件，便于在其它页面复用。
- 增加趋势迷你图与保存筛选方案；支持导出当前视图的名单。
