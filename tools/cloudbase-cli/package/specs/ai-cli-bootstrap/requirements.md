# 需求文档

## 介绍

本需求旨在为云开发 CLI（CloudBase CLI）集成 AI 开发向导能力，内置云开发 AI ToolKit，支持主流 AI 编程 CLI（如 Claude Code、Opencode、Gemini CLI 等）的快速启动和配置。  
该功能不直接集成第三方 CLI 工具，而是作为启动器和配置助手，提供极简与高级两种配置模式，内置云开发最佳实践和部署能力，并支持本地/远程大模型的灵活切换。  
如本地未安装相关 AI CLI，则引导用户安装；如已安装，则可自动唤起并传递配置。  
同时，解决现有实现中的环境变量、参数传递、CLI 兼容性、模板解压等问题。

## 需求

### 需求 1 - AI 开发向导启动与配置

**用户故事：**  
作为一名开发者，我希望通过云开发 CLI 一键启动 AI 编程助手（如 Claude Code、Opencode、Gemini CLI），并能自动完成环境检测、配置和最佳实践集成，从而快速体验和使用 AI 编程能力。

#### 验收标准

1. When 用户在云开发 CLI 中执行 AI 向导命令时，系统应检测本地是否已安装主流 AI CLI 工具（如 claude、opencode、gemini 等）。
2. When 本地未安装目标 CLI 工具时，系统应输出清晰的安装指引（如 npm install -g @anthropic-ai/claude-code），并提示用户完成安装。
3. When 本地已安装目标 CLI 工具时，系统应自动唤起该工具，并可传递必要的环境变量和参数（如环境 ID、API Key、模型类型等）。
4. When 用户选择极简模式时，系统应默认使用云开发内置 DeepSeek 大模型，无需复杂配置即可体验 AI 编程。
5. When 用户选择高级模式时，系统应支持自定义 AI 大模型（如 claude/k2/qwen/gemini/openrouter/ollama 等），并可配置 API 协议、路由、密钥等参数。
6. When 目标 AI CLI 支持 anthropic 协议时，系统应自动透传相关参数（如 claude/k2/kimi 等）。
7. When 目标 AI CLI 支持 OpenAI 协议时，系统应自动透传相关参数，或通过 claude-code-router 进行协议转发。
8. When 用户配置了 claude-code-router，系统应支持自动检测和路由转发，支持多模型和多后端切换。
9. When 用户在微信开发者工具等特殊终端使用时，CLI 输出应兼容终端特性（如防止滚动、支持浅色/深色模式）。
10. When 用户通过 CLI 下载模板包时，系统应确保所有必要文件（包括小程序文件夹）完整解压。

### 需求 2 - 兼容性与用户体验优化

**用户故事：**  
作为一名开发者，我希望云开发 CLI 的 AI 向导功能在不同终端和操作系统下都能稳定运行，输出内容美观、易读，并能及时反馈错误和操作建议。

#### 验收标准

1. When CLI 输出 CloudBase AI CLI 相关文字时，应自动适配浅色/深色终端，保证可读性。
2. When 在微信开发者工具等特殊终端运行时，CLI 输出应避免内容被自动滚动，保证用户能看到最新提示。
3. When CLI 发生错误（如参数传递失败、环境变量缺失、模板解压不完整等），应输出明确的错误信息和修复建议。
4. When 用户需要帮助时，CLI 应提供详细的帮助文档和最佳实践指引。

### 需求 3 - 安全与合规

**用户故事：**  
作为一名企业开发者，我希望云开发 CLI 的 AI 向导功能在集成第三方 AI CLI 时，能够遵守合规要求，不直接集成或分发第三方工具，仅作为启动器和配置助手。

#### 验收标准

1. When 启动第三方 AI CLI 时，系统不得直接集成或分发其代码，仅作为启动器和配置助手。
2. When 需要传递敏感信息（如 API Key）时，系统应遵循最佳安全实践，避免明文泄露。
3. When 用户未授权时，系统不得自动收集或上传用户数据。
