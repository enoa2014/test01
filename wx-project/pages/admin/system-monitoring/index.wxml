<!-- pages/admin/system-monitoring/index.wxml -->
<view class="system-monitoring">
  <!-- éª¨æ¶å± -->
  <skeleton-screen show="{{showSkeleton}}" type="page,stats,chart,grid,list" rows="8"></skeleton-screen>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="header-title">ç³»ç»Ÿç›‘æ§</text>
      <text class="header-subtitle">å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡</text>
    </view>
    <view class="header-actions">
      <button class="refresh-btn" bindtap="refreshAllData">
        <text class="btn-icon">ğŸ”„</text>
        <text class="btn-text">åˆ·æ–°æ•°æ®</text>
      </button>
    </view>
  </view>

  <!-- ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ -->
  <view class="status-overview">
    <view class="status-card status-card--{{systemStatus.overall}}">
      <view class="status-icon">
        <text class="icon-{{systemStatus.overall}}">{{getStatusIcon(systemStatus.overall)}}</text>
      </view>
      <view class="status-info">
        <text class="status-title">ç³»ç»ŸçŠ¶æ€</text>
        <text class="status-text">{{getStatusText(systemStatus.overall)}}</text>
        <text class="update-time">æ›´æ–°äº {{systemStatus.updateTime}}</text>
      </view>
    </view>

    <view class="quick-stats">
      <view class="quick-stat">
        <text class="stat-number">{{quickStats.onlineUsers}}</text>
        <text class="stat-label">åœ¨çº¿ç”¨æˆ·</text>
      </view>
      <view class="quick-stat">
        <text class="stat-number">{{quickStats.activeConnections}}</text>
        <text class="stat-label">æ´»è·ƒè¿æ¥</text>
      </view>
      <view class="quick-stat">
        <text class="stat-number">{{quickStats.requestRate}}</text>
        <text class="stat-label">è¯·æ±‚/ç§’</text>
      </view>
    </view>
  </view>

  <!-- æ€§èƒ½æŒ‡æ ‡ -->
  <view class="performance-section">
    <view class="section-header">
      <text class="section-title">æ€§èƒ½æŒ‡æ ‡</text>
      <text class="section-subtitle">ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ</text>
    </view>

    <view class="performance-grid">
      <view class="perf-card">
        <view class="perf-header">
          <text class="perf-title">CPU ä½¿ç”¨ç‡</text>
          <text class="perf-value">{{performance.cpu}}%</text>
        </view>
        <view class="perf-chart">
          <view class="chart-container">
            <view class="progress-ring" style="transform: rotate(-90deg)">
              <view class="progress-ring-circle" style="stroke-dasharray: {{performance.cpu}} 100"></view>
            </view>
            <text class="chart-label">{{performance.cpu}}%</text>
          </view>
        </view>
        <view class="perf-trend {{getTrendClass(performance.cpuTrend)}}">
          <text class="trend-icon">{{getTrendIcon(performance.cpuTrend)}}</text>
          <text class="trend-text">{{performance.cpuTrend}}%</text>
        </view>
      </view>

      <view class="perf-card">
        <view class="perf-header">
          <text class="perf-title">å†…å­˜ä½¿ç”¨ç‡</text>
          <text class="perf-value">{{performance.memory}}%</text>
        </view>
        <view class="perf-chart">
          <view class="chart-container">
            <view class="progress-ring" style="transform: rotate(-90deg)">
              <view class="progress-ring-circle" style="stroke-dasharray: {{performance.memory}} 100"></view>
            </view>
            <text class="chart-label">{{performance.memory}}%</text>
          </view>
        </view>
        <view class="perf-trend {{getTrendClass(performance.memoryTrend)}}">
          <text class="trend-icon">{{getTrendIcon(performance.memoryTrend)}}</text>
          <text class="trend-text">{{performance.memoryTrend}}%</text>
        </view>
      </view>

      <view class="perf-card">
        <view class="perf-header">
          <text class="perf-title">å­˜å‚¨ä½¿ç”¨ç‡</text>
          <text class="perf-value">{{performance.storage}}%</text>
        </view>
        <view class="perf-chart">
          <view class="chart-container">
            <view class="progress-ring" style="transform: rotate(-90deg)">
              <view class="progress-ring-circle" style="stroke-dasharray: {{performance.storage}} 100"></view>
            </view>
            <text class="chart-label">{{performance.storage}}%</text>
          </view>
        </view>
        <view class="perf-trend {{getTrendClass(performance.storageTrend)}}">
          <text class="trend-icon">{{getTrendIcon(performance.storageTrend)}}</text>
          <text class="trend-text">{{performance.storageTrend}}%</text>
        </view>
      </view>

      <view class="perf-card">
        <view class="perf-header">
          <text class="perf-title">ç½‘ç»œæµé‡</text>
          <text class="perf-value">{{performance.network}} MB/s</text>
        </view>
        <view class="perf-chart">
          <view class="network-chart">
            <view class="network-bars">
              <view class="network-bar" style="height: {{performance.networkIn}}%"></view>
              <view class="network-bar" style="height: {{performance.networkOut}}%"></view>
            </view>
            <view class="network-legend">
              <text class="legend-item">å…¥ç«™: {{performance.networkIn}}%</text>
              <text class="legend-item">å‡ºç«™: {{performance.networkOut}}%</text>
            </view>
          </view>
        </view>
        <view class="perf-trend {{getTrendClass(performance.networkTrend)}}">
          <text class="trend-icon">{{getTrendIcon(performance.networkTrend)}}</text>
          <text class="trend-text">{{performance.networkTrend}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡çŠ¶æ€ -->
  <view class="services-section">
    <view class="section-header">
      <text class="section-title">æœåŠ¡çŠ¶æ€</text>
      <text class="section-subtitle">æ ¸å¿ƒæœåŠ¡è¿è¡ŒçŠ¶æ€</text>
    </view>

    <view class="services-grid">
      <view class="service-card service-card--{{item.status}}" wx:for="{{services}}" wx:key="name">
        <view class="service-header">
          <view class="service-icon">
            <text class="icon-{{item.status}}">{{getServiceIcon(item.status)}}</text>
          </view>
          <view class="service-info">
            <text class="service-name">{{item.name}}</text>
            <text class="service-version">v{{item.version}}</text>
          </view>
          <view class="service-status">
            <view class="status-badge status-badge--{{item.status}}">
              {{getServiceStatusText(item.status)}}
            </view>
          </view>
        </view>
        <view class="service-metrics">
          <view class="metric-item">
            <text class="metric-label">å“åº”æ—¶é—´</text>
            <text class="metric-value">{{item.responseTime}}ms</text>
          </view>
          <view class="metric-item">
            <text class="metric-label">æˆåŠŸç‡</text>
            <text class="metric-value">{{item.successRate}}%</text>
          </view>
          <view class="metric-item">
            <text class="metric-label">QPS</text>
            <text class="metric-value">{{item.qps}}</text>
          </view>
        </view>
        <view class="service-actions">
          <button class="action-btn action-btn--restart" bindtap="restartService" data-name="{{item.name}}" wx:if="{{item.status !== 'running'}}">
            é‡å¯
          </button>
          <button class="action-btn action-btn--detail" bindtap="viewServiceDetail" data-name="{{item.name}}">
            è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å‘Šè­¦ä¿¡æ¯ -->
  <view class="alerts-section">
    <view class="section-header">
      <text class="section-title">å‘Šè­¦ä¿¡æ¯</text>
      <text class="section-subtitle">ç³»ç»Ÿå‘Šè­¦å’Œå¼‚å¸¸é€šçŸ¥</text>
      <view class="alert-filter">
        <text class="filter-btn {{alertFilter === 'all' ? 'active' : ''}}" bindtap="setAlertFilter" data-filter="all">å…¨éƒ¨</text>
        <text class="filter-btn {{alertFilter === 'critical' ? 'active' : ''}}" bindtap="setAlertFilter" data-filter="critical">ç´§æ€¥</text>
        <text class="filter-btn {{alertFilter === 'warning' ? 'active' : ''}}" bindtap="setAlertFilter" data-filter="warning">è­¦å‘Š</text>
      </view>
    </view>

    <view class="alerts-list" wx:if="{{filteredAlerts.length > 0}}">
      <view class="alert-item alert-item--{{item.level}}" wx:for="{{filteredAlerts}}" wx:key="id">
        <view class="alert-header">
          <view class="alert-icon">
            <text class="icon-{{item.level}}">{{getAlertIcon(item.level)}}</text>
          </view>
          <view class="alert-info">
            <text class="alert-title">{{item.title}}</text>
            <text class="alert-time">{{item.time}}</text>
          </view>
          <view class="alert-status">
            <view class="status-badge status-badge--{{item.status}}">
              {{getAlertStatusText(item.status)}}
            </view>
          </view>
        </view>
        <view class="alert-content">
          <text class="alert-description">{{item.description}}</text>
        </view>
        <view class="alert-actions">
          <button class="action-btn action-btn--resolve" bindtap="resolveAlert" data-id="{{item.id}}" wx:if="{{item.status === 'active'}}">
            å¤„ç†
          </button>
          <button class="action-btn action-btn--ignore" bindtap="ignoreAlert" data-id="{{item.id}}" wx:if="{{item.status === 'active'}}">
            å¿½ç•¥
          </button>
          <button class="action-btn action-btn--detail" bindtap="viewAlertDetail" data-id="{{item.id}}">
            è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>

    <view class="empty-alerts" wx:else>
      <text class="empty-icon">âœ…</text>
      <text class="empty-text">æš‚æ— å‘Šè­¦ä¿¡æ¯</text>
      <text class="empty-desc">ç³»ç»Ÿè¿è¡Œæ­£å¸¸</text>
    </view>
  </view>

  <!-- å®æ—¶æ—¥å¿— -->
  <view class="logs-section">
    <view class="section-header">
      <text class="section-title">å®æ—¶æ—¥å¿—</text>
      <text class="section-subtitle">ç³»ç»Ÿè¿è¡Œæ—¥å¿—æµ</text>
      <view class="log-controls">
        <text class="control-btn {{autoScroll ? 'active' : ''}}" bindtap="toggleAutoScroll">
          {{autoScroll ? 'è‡ªåŠ¨æ»šåŠ¨' : 'åœæ­¢æ»šåŠ¨'}}
        </text>
        <text class="control-btn" bindtap="clearLogs">æ¸…ç©º</text>
      </view>
    </view>

    <view class="logs-container" id="logsContainer">
      <view class="log-item log-item--{{item.level}}" wx:for="{{logs}}" wx:key="id">
        <text class="log-time">{{item.time}}</text>
        <text class="log-level level-badge level-badge--{{item.level}}">{{item.level}}</text>
        <text class="log-message">{{item.message}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button class="action-card" bindtap="viewDetailedMetrics">
      <text class="action-icon">ğŸ“Š</text>
      <text class="action-title">è¯¦ç»†æŒ‡æ ‡</text>
      <text class="action-desc">æŸ¥çœ‹æ›´å¤šç³»ç»ŸæŒ‡æ ‡</text>
    </button>

    <button class="action-card" bindtap="viewHistoricalData">
      <text class="action-icon">ğŸ“ˆ</text>
      <text class="action-title">å†å²æ•°æ®</text>
      <text class="action-desc">æŸ¥çœ‹å†å²è¶‹åŠ¿åˆ†æ</text>
    </button>

    <button class="action-card" bindtap="viewOptimizationSuggestions">
      <text class="action-icon">ğŸ’¡</text>
      <text class="action-title">ä¼˜åŒ–å»ºè®®</text>
      <text class="action-desc">æŸ¥çœ‹ç³»ç»Ÿä¼˜åŒ–å»ºè®®</text>
    </button>

    <button class="action-card" bindtap="performHealthCheck">
      <text class="action-icon">ğŸ”</text>
      <text class="action-title">å¥åº·æ£€æŸ¥</text>
      <text class="action-desc">æ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥</text>
    </button>

    <button class="action-card" bindtap="exportReport">
      <text class="action-icon">ğŸ“„</text>
      <text class="action-title">å¯¼å‡ºæŠ¥å‘Š</text>
      <text class="action-desc">ç”Ÿæˆç›‘æ§æŠ¥å‘Š</text>
    </button>
  </view>

  <!-- æœåŠ¡è¯¦æƒ…å¼¹çª— -->
  <view class="service-detail-modal" wx:if="{{showServiceModal}}">
    <view class="modal-mask" bindtap="closeServiceModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æœåŠ¡è¯¦æƒ… - {{selectedService.name}}</text>
        <text class="modal-close" bindtap="closeServiceModal">Ã—</text>
      </view>

      <view class="modal-body" wx:if="{{selectedService}}">
        <view class="detail-section">
          <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
          <view class="detail-grid">
            <view class="detail-item">
              <text class="detail-label">æœåŠ¡åç§°ï¼š</text>
              <text class="detail-value">{{selectedService.name}}</text>
            </view>
            <view class="detail-item">
              <text class="detail-label">ç‰ˆæœ¬ï¼š</text>
              <text class="detail-value">v{{selectedService.version}}</text>
            </view>
            <view class="detail-item">
              <text class="detail-label">çŠ¶æ€ï¼š</text>
              <view class="status-badge status-badge--{{selectedService.status}}">
                {{getServiceStatusText(selectedService.status)}}
              </view>
            </view>
            <view class="detail-item">
              <text class="detail-label">å¯åŠ¨æ—¶é—´ï¼š</text>
              <text class="detail-value">{{selectedService.startTime}}</text>
            </view>
          </view>
        </view>

        <view class="detail-section">
          <text class="section-title">æ€§èƒ½æŒ‡æ ‡</text>
          <view class="metrics-grid">
            <view class="metric-card">
              <text class="metric-number">{{selectedService.responseTime}}</text>
              <text class="metric-label">å“åº”æ—¶é—´ (ms)</text>
            </view>
            <view class="metric-card">
              <text class="metric-number">{{selectedService.successRate}}%</text>
              <text class="metric-label">æˆåŠŸç‡</text>
            </view>
            <view class="metric-card">
              <text class="metric-number">{{selectedService.qps}}</text>
              <text class="metric-label">QPS</text>
            </view>
            <view class="metric-card">
              <text class="metric-number">{{selectedService.uptime}}</text>
              <text class="metric-label">è¿è¡Œæ—¶é—´</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn modal-btn--restart" bindtap="restartService" data-name="{{selectedService.name}}">
          é‡å¯æœåŠ¡
        </button>
        <button class="modal-btn modal-btn--close" bindtap="closeServiceModal">
          å…³é—­
        </button>
      </view>
    </view>
  </view>
</view>